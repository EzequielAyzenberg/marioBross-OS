#include "bowser.h"

static void _bowser_adaptToMaxHeight(t_bowser*, int maxHeight);

t_bowser* bowser_create(int x, int y, int maxHeight) {
	t_bowser* this = new(t_bowser);
	this->update = NULL;

	this->position.x = x;
	this->position.y = y;
	this->position.z = 0;

	this->text =        string_duplicate("~~~~~~~~~~~~~47774\n~~~~~~~~~~~~4747474\n~~~~~~~~~~~47114774\n~~~~~~~~44411447774744\n~~~~~~~4114443777444774\n~~~~~44111143377741174\n~~~~41114422433341714\n~~~~~447742224441117744\n~~4444777422222241111714\n~433344774222222411111174\n~433333342244222224111744\n~433333334433422224711774\n~~473333333333422244717174\n~~474773333333422444411414\n~~~4477447733344433344474\n~~~~~4444443344333442377444444\n~~~~43333444433423722222377774\n~~~~~~443333443334242244247774\n~~~~~~~4444~443342377222222374\n~~~~~~~~~~~~443342222377722334\n~~~~~~~~~~~4343342222377722224\n~~~~~~~~~~~43343344222377222374\n~~~~~~~~~~~433433334222332222374\n~~~~~444~~~43334333442222222234\n~~~~473344444333433343772222224\n~~~~~43333474433433342372377724\n~~~~~433334444333433442323772374\n~~~~433333444433343342222377234\n~~~4733333444443343344222233224\n~~~~44333347444444433344222224\n~~~~~473344433433433333442224\n~~~~~~444~~~~~~4~~4~~~~~~444");
	this->colors_text = string_duplicate("000000000000047774\n0000000000004747474\n0000000000047114774\n0000000044411447774744\n00000004114443777444774\n0000044111143377741174\n000041114422433341714\n00000447742224441117744\n004444777422222241111714\n0433344774222222411111174\n0433333342244222224111744\n0433333334433422224711774\n00473333333333422244717174\n00474773333333422444411414\n0004477447733344433344474\n000004444443344333442377444444\n000043333444433423722222377774\n000000443333443334242244247774\n000000044440443342377222222374\n000000000000443342222377722334\n000000000004343342222377722224\n0000000000043343344222377222374\n00000000000433433334222332222374\n0000044400043334333442222222234\n0000473344444333433343772222224\n0000043333474433433342372377724\n00000433334444333433442323772374\n0000433333444433343342222377234\n0004733333444443343344222233224\n000044333347444444433344222224\n00000473344433433433333442224\n0000004440000004004000000444");
	this->colors_back = string_duplicate("000000000000047774\n0000000000004747474\n0000000000047114774\n0000000044411447774744\n00000004114443777444774\n0000044111143377741174\n000041114422433341714\n00000447742224441117744\n004444777422222241111714\n0433344774222222411111174\n0433333342244222224111744\n0433333334433422224711774\n00473333333333422244717174\n00474773333333422444411414\n0004477447733344433344474\n000004444443344333442377444444\n000043333444433423722222377774\n000000443333443334242244247774\n000000044440443342377222222374\n000000000000443342222377722334\n000000000004343342222377722224\n0000000000043343344222377222374\n00000000000433433334222332222374\n0000044400043334333442222222234\n0000473344444333433343772222224\n0000043333474433433342372377724\n00000433334444333433442323772374\n0000433333444433343342222377234\n0004733333444443343344222233224\n000044333347444444433344222224\n00000473344433433433333442224\n0000004440000004004000000444");

	_bowser_adaptToMaxHeight(this, maxHeight);

	return this;
}

void bowser_killLastLine(t_bowser* this) {
	int lastLine = 0;
	for(int i=0; i < strlen(this->text); i++) {
		if (this->text[i] == '\n')
			lastLine = i;
	}

	this->text[lastLine] = '\0';
	this->colors_text[lastLine] = '\0';
	this->colors_back[lastLine] = '\0';
}

static void _bowser_adaptToMaxHeight(t_bowser* this, int maxHeight) {
	int _charCount(char* string, char c) {
		int count = 0;
		for(int i=0; i < strlen(string); i++)
			if (string[i] == c) count++;
		return count;
	}

	while(_charCount(this->text, '\n') + 1 > maxHeight)
		bowser_killLastLine(this);
}
